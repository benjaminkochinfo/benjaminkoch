<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Insider Terminal — Briefings</title>
<meta name="description" content="Quiet, data-aware briefs for resilient strategists — independent, client-first.">
<meta name="robots" content="index,follow">
<style>
:root{--bg:#0b0c0e;--panel:#121317;--grid:#1b1d22;--text:#e6e6ea;--muted:#b7bcc6;--blue:#1f77b4;--orange:#ff7f0e}
*{box-sizing:border-box}
body{margin:0;background:var(--bg);color:var(--text);font-family:Inter,system-ui,-apple-system,'Segoe UI',Roboto,Arial,sans-serif;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}
a{color:inherit}
.header{position:sticky;top:0;z-index:20;border-bottom:1px solid var(--grid);background:rgba(11,12,14,.88);backdrop-filter:blur(8px)}
.container{max-width:1180px;margin:0 auto;padding:12px 16px}
.brand{display:flex;align-items:center;gap:12px}
.logo{height:44px;width:44px;border-radius:10px;border:1px solid var(--grid);display:grid;place-items:center;background:radial-gradient(120% 100% at 0% 0%,#1a1e26 0%,#0b0c0e 60%)}
.title{line-height:1.05;position:relative;padding-top:6px}
.title h1{margin:0;font-size:26px;font-weight:800;letter-spacing:-.01em;display:inline-block;position:relative}
.anywhere{letter-spacing:.12em;font-weight:700;font-size:12px;opacity:.9;margin-left:8px}
.tagline{margin:2px 0 0 0;font-size:13px;opacity:.8}
.cursor-square{position:absolute;left:0;top:-6px;width:12px;height:12px;border-radius:2px;background:#1f77b4;box-shadow:0 0 10px rgba(31,119,180,.55);animation:blink 1s steps(1,end) infinite;outline:1px solid rgba(255,255,255,.25);outline-offset:-1px}
@keyframes blink{0%,49%{opacity:1}50%,100%{opacity:0}}
.banner{border-bottom:1px solid var(--grid);background-image:linear-gradient(0deg,transparent 24px, rgba(255,255,255,.04) 25px),linear-gradient(90deg,transparent 24px, rgba(255,255,255,.04) 25px);background-size:25px 25px}
.panel{border:1px solid rgba(255,255,255,.08);background:var(--panel);border-radius:14px;box-shadow:0 0 0 1px rgba(255,255,255,.04),0 16px 40px rgba(0,0,0,.55);padding:14px}
.kicker{text-transform:uppercase;letter-spacing:.12em;font-size:10px;color:#9aa1ae}
.headline{color:var(--orange);font-size:20px;margin:4px 0 0 0;text-shadow:0 0 12px rgba(255,127,14,.14);font-weight:800}
.deck{color:#d6d6dc;font-size:14px;margin:6px 0 0 0}
.badge{display:inline-block;font-size:10px;padding:.12rem .42rem;border-radius:999px;border:1px solid rgba(255,255,255,.12);background:rgba(255,255,255,.04);color:#cfd3da;margin-right:6px}
.meta{display:flex;align-items:center;gap:8px;font-size:12px;opacity:.85;margin-top:6px;flex-wrap:wrap}
.prose{line-height:1.88;color:var(--text);font-size:16px;margin-top:10px;text-align:justify;text-justify:inter-word;hyphens:auto}
.prose p{margin:.6rem 0}
.grid{display:grid;gap:16px}
.posts{display:grid;grid-template-columns:1fr;align-items:start}
@media(min-width:900px){.posts{grid-template-columns:1fr 1fr}}
.charts-grid{display:grid;gap:12px;margin-top:10px}
@media(min-width:900px){.charts-grid{grid-template-columns:1fr 1fr}}
.chartwrap{height:400px}
@media(max-width:700px){.chartwrap{height:300px}}
canvas{display:block;background:rgba(17,17,19,.25);border-radius:10px;padding:8px;width:100%;height:100%}
#topic-chips{display:flex;flex-wrap:nowrap;gap:6px;overflow:hidden;align-items:center}
#topic-chips .badge{font-size:10px;white-space:nowrap}
#archive .chips{display:flex;flex-wrap:wrap;gap:8px}
#archive h3{margin:0 0 6px 0}
#archive p.note{opacity:.85;font-size:13px;margin:6px 0 10px 0}
.error{position:fixed;right:12px;top:12px;max-width:520px;background:rgba(0,0,0,.88);color:#fff;padding:12px;border:1px solid #c33;border-radius:8px;font:12px ui-monospace,Consolas,monospace;display:none;z-index:9999;white-space:pre-wrap}
footer{border-top:1px solid var(--grid);padding:20px 0;color:var(--muted);font-size:13px}
@media print{header,.banner,footer,#archive,#topic-chips{display:none !important}body{background:#fff;color:#000}canvas{height:440px}}
</style>
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
</head>
<body>
<div id="err" class="error"></div>

<header class="header">
  <div class="container brand">
    <div class="logo" title="Insider Terminal">
      <!-- Blue IT, two orange dots -->
      <svg viewBox="0 0 64 64" width="38" height="38" xmlns="http://www.w3.org/2000/svg" aria-label="IT">
        <rect x="2" y="2" width="60" height="60" rx="12" fill="#0b0d12"/>
        <text x="32" y="40" text-anchor="middle" font-family="Inter,system-ui,-apple-system,Segoe UI,Roboto,sans-serif" font-weight="800" font-size="28" fill="#1f77b4">IT</text>
        <circle cx="12" cy="12" r="2.4" fill="#ff7f0e" opacity=".9"/>
        <circle cx="52" cy="50" r="2.4" fill="#ff7f0e" opacity=".9"/>
      </svg>
    </div>
    <div class="title">
      <span class="cursor-square" aria-hidden="true"></span>
      <div style="display:flex;align-items:flex-end;gap:8px">
        <h1>Insider Terminal</h1><span class="anywhere">ANYWHERE</span>
      </div>
      <p class="tagline">Briefings for resilient strategists.</p>
    </div>
  </div>
</header>

<div class="banner">
  <div class="container" style="color:#b7bcc6;font-size:14px">
    Daily briefs across markets, policy, psychology. Independent, client-first, optimistic by design.
  </div>
</div>

<main class="container" style="padding:14px 16px">
  <section class="panel">
    <h2 class="section-title" style="font-size:18px;line-height:1.15">Today’s Edition <span id="datestamp" style="opacity:.8;font-weight:600"></span></h2>
    <p id="edition-sub" style="opacity:.9;font-size:14px;margin:6px 0 10px 0">An insider terminal blog since 2020 — clean, data-aware, and relentlessly constructive.</p>
    <div id="topic-chips" class="chips" style="margin:6px 0 8px 0"></div>
    <div id="sections"></div>
  </section>
</main>

<section id="archive" class="container" style="padding:0 16px 18px 16px">
  <div class="panel">
    <h3 class="section-title">Archive <span id="arcYears" style="opacity:.8"></span></h3>
    <div class="chips" id="archive-list"></div>
    <p class="note">Select a month to render a representative weekday edition.</p>
  </div>
</section>

<footer>
  <div class="container" style="display:flex;justify-content:space-between;gap:12px;flex-wrap:wrap">
    <p>No affiliations. No mailing list. No noise.</p>
    <p>© 2025 Insider Terminal — Briefings. by Benjamin Koch</p>
  </div>
  <div class="container" style="font-size:12px;margin-top:6px">
    <strong>Disclaimer.</strong> This material is commentary for informational purposes only and does not constitute investment, legal, accounting, or tax advice; an offer to buy or sell any security, commodity or instrument; or a solicitation of any strategy. Information is believed reliable but provided “as is” without warranties of completeness or accuracy. Opinions are subject to change. You are solely responsible for your decisions and compliance with applicable law. We disclaim all liability for any direct or consequential loss arising from use of this content.
  </div>
</footer>

<script>
/* ================= Error Surface ================= */
const errBox=document.getElementById('err');
addEventListener('error',e=>{errBox.style.display='block';errBox.textContent='JS error: '+(e.message||e.error)});
addEventListener('unhandledrejection',e=>{errBox.style.display='block';errBox.textContent='Promise rejection: '+(e.reason && (e.reason.message||e.reason))});

/* ================= Helpers ================= */
const qs=(s,r=document)=>r.querySelector(s);
function rint(min,max){return Math.floor(Math.random()*(max-min+1))+min}
function esc(t){return (t||'').replace(/[&<>"']/g,m=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;'}[m]))}
function ensureWeekday(date){const d=new Date(date),g=d.getDay(); if(g===0)d.setDate(d.getDate()-2); if(g===6)d.setDate(d.getDate()-1); return d}
function randomCETDisplayString(dateObj){const d=ensureWeekday(dateObj),startMin=390,endMin=1350,chosen=rint(startMin,endMin);const hh=('0'+Math.floor(chosen/60)).slice(-2),mm=('0'+(chosen%60)).slice(-2);const opts={timeZone:'Europe/Berlin',year:'numeric',month:'short',day:'2-digit',hour:'2-digit',minute:'2-digit',hour12:false,timeZoneName:'short'};const disp=new Intl.DateTimeFormat(undefined,opts).format(new Date(d.getFullYear()+'-'+('0'+(d.getMonth()+1)).slice(-2)+'-'+('0'+d.getDate()).slice(-2)+'T'+hh+':'+mm+':00'));return disp.replace(',','')}
function monthAxis(n,future){const out=[],d=new Date();for(let i=n-1;i>=-future;i--){const dt=new Date(d.getFullYear(),d.getMonth()-i,1);out.push(dt.toLocaleDateString(undefined,{month:'short',year:'2-digit'}))}return out}
function rwalk(n,start,vol){let v=start,out=[];for(let i=0;i<n;i++){v+=(Math.random()*2-1)*vol;out.push(+v.toFixed(2))}return out}
function withFutureSpace(series,future){for(let i=0;i<future;i++)series.push(null);return series}
function makeForecast(series,extra){const n=series.length,k=Math.min(6,n-1),xs=[],ys=[];for(let i=n-k;i<n;i++){xs.push(i);ys.push(series[i])}const mean=a=>a.reduce((x,y)=>x+y,0)/a.length;const mx=mean(xs),my=mean(ys);let num=0,den=0;for(let i=0;i<xs.length;i++){num+=(xs[i]-mx)*(ys[i]-my);den+=(xs[i]-mx)**2}const slope=den?num/den:0;const last=series[n-1];const f=[];for(let i=1;i<=extra;i++)f.push(+(last+slope*i).toFixed(2));return f}

/* ================= Charts ================= */
function sizeCanvas(c){const h=c.parentElement||c;const w=h.clientWidth||600;let k=Math.round(w*.6);const m=matchMedia('(max-width:640px)').matches;k=Math.max(m?260:320,Math.min(m?420:560,k));c.style.height=k+'px'}
function gradientBlue(ctx){const g=ctx.createLinearGradient(0,0,0,260);g.addColorStop(0,'rgba(31,119,180,.35)');g.addColorStop(1,'rgba(31,119,180,.05)');return g}
const FutureShade={id:'futureShade',beforeDatasetsDraw(chart){const ca=chart.chartArea;if(!chart.scales||!chart.scales.x)return;const idx=chart.data.labels.length-6-0.5;const x=chart.scales.x.getPixelForValue(idx);if(!isFinite(x))return;const ctx=chart.ctx;ctx.save();ctx.fillStyle='rgba(255,255,255,.035)';ctx.fillRect(x,ca.top,Math.max(0,ca.right-x),ca.bottom-ca.top);ctx.restore()}};
const LastPriceLine={id:'lastPriceLine',afterDatasetsDraw(chart){const ds=chart.data.datasets.find(d=>d._isPrice);if(!ds)return;let j=-1;for(let i=ds.data.length-1;i>=0;i--){if(ds.data[i]!=null){j=i;break}}if(j<0)return;const meta=chart.getDatasetMeta(chart.data.datasets.indexOf(ds)),pt=meta.data[j],ctx=chart.ctx,ca=chart.chartArea;if(!pt)return;ctx.save();ctx.setLineDash([4,4]);ctx.strokeStyle='rgba(255,255,255,.35)';ctx.beginPath();ctx.moveTo(ca.left,pt.y);ctx.lineTo(ca.right,pt.y);ctx.stroke();ctx.restore()}};
const PriceTag={id:'priceTag',afterDatasetsDraw(chart){const ds=chart.data.datasets.find(d=>d._isPrice);if(!ds)return;let j=-1,val=null;for(let i=ds.data.length-1;i>=0;i--){if(ds.data[i]!=null){j=i;val=ds.data[i];break}}if(j<0)return;const meta=chart.getDatasetMeta(chart.data.datasets.indexOf(ds)),node=meta.data[j],y=node.y,ctx=chart.ctx,ca=chart.chartArea;const txt=String(val);ctx.save();ctx.font='12px system-ui,-apple-system,Segoe UI,Roboto,sans-serif';const w=ctx.measureText(txt).width+22,h=18,x=ca.right-w+1,yy=Math.max(ca.top+10,Math.min(ca.bottom-10,y-h/2));ctx.fillStyle='#fff';ctx.beginPath();ctx.moveTo(x,yy);ctx.lineTo(x+w-10,yy);ctx.lineTo(x+w-10,yy+h);ctx.lineTo(x,yy+h);ctx.closePath();ctx.fill();ctx.beginPath();ctx.moveTo(x+w-10,yy);ctx.lineTo(x+w,yy+h/2);ctx.lineTo(x+w-10,yy+h);ctx.closePath();ctx.fill();ctx.fillStyle='#111';ctx.fillText(txt,x+8,yy+12.5);ctx.restore()}};
function drawChart(canvas,spec){
  if(!window.Chart) return null;
  sizeCanvas(canvas);
  const ctx=canvas.getContext('2d');
  const datasets=[];
  datasets.push({label:spec.title,data:spec.series[0].data,type:'line',borderWidth:2.2,tension:.25,pointRadius:0,spanGaps:false,borderColor:'rgba(31,119,180,.95)',backgroundColor:gradientBlue(ctx),fill:true});
  datasets.push({label:spec.title+' (price)',data:spec.series[1].data,type:'line',borderWidth:2,tension:.25,pointRadius:0,spanGaps:false,borderColor:'#ffffff',backgroundColor:'rgba(255,255,255,0)',fill:false,_isPrice:true});
  datasets.push({label:spec.title+' (proj.)',data:spec.series[2].data,type:'line',borderWidth:1.6,tension:.25,pointRadius:spec.series[2].data.map((v,i,a)=>i===a.length-1?5:0),pointStyle:spec.series[2].data.map((v,i,a)=>i===a.length-1?'triangle':'circle'),spanGaps:false,borderColor:'rgba(255,255,255,.9)',backgroundColor:'rgba(255,255,255,0)',fill:false,borderDash:[4,4]});
  return new Chart(ctx,{type:'line',data:{labels:spec.labels,datasets},options:{responsive:true,maintainAspectRatio:false,layout:{padding:{right:32}},scales:{x:{ticks:{color:'rgba(230,230,234,.9)'},grid:{color:'rgba(255,255,255,.08)'}},y:{ticks:{color:'rgba(230,230,234,.9)'},grid:{color:'rgba(255,255,255,.08)'}}},plugins:{legend:{display:false},tooltip:{mode:'index',intersect:false}}},[FutureShade,LastPriceLine,PriceTag]);
}

/* ================= Diction ================= */
let OPENERS = [
  h=>`Context first, noise last. The signal today: ${h}.`,
  h=>`From a policy-agnostic, client-first lens: ${h}.`,
  h=>`Sequencing beats spectacle. The practical takeaway: ${h}.`,
  h=>`We privilege cash-flow logic over fashion. Today that means: ${h}.`,
  h=>`Risk is sized to your sleep, not to headlines. The case today: ${h}.`,
  h=>`Calm operators don’t predict; they prepare. Preparation suggests: ${h}.`,
  h=>`We separate incentives from narratives. The incentive map points to: ${h}.`
];

let OPTIMISM = [
  "Stay constructive without being complacent.",
  "Harvest the easy basis and let the hard trades prove they deserve capital.",
  "Scale what works; starve what argues back.",
  "Keep risk sized to your sleep, not to the loudest story.",
  "Let the funding math veto the drama.",
  "Keep the habit compounding; let luck arrive embarrassed.",
  "Make patience your edge and sequence your risk.",
  "If it doesn’t pay in basis or cash flow, it’s a hobby."
];

let DEK_VERBS = {
  markets:["maps incentives","prices patience","tests positioning","rewards structure","disciplines drama","compresses stories","pays sequences"],
  policy:["moves cash-flows","quietly rewrites borders","tightens collateral","reopens channels","narrows discretion","rearranges liabilities"],
  behaviour:["taxes impatience","prices bias","teaches forbearance","punishes FOMO","rewards sequencing","disciplines reflex"],
  energy:["translates scarcity","argues in barrels","lets freight decide","leans on storage","pays crack spreads","balances throughput"],
  fx:["listens to real yields","steepens the story","tests carry","prices divergence","favors liquidity"],
  housing:["meets wages","reopens credit boxes","disciplines stories","finds a behavioural floor","normalizes issuance"],
  commodities:["relearns gravity","prices logistics","reopens arbitrage","normalizes supply","compresses vol"],
  metals:["flags scarcity","prices forbearance","tracks funding","tests patience","remembers basis"],
  coffee:["tightens differentials","listens to weather","normalizes premiums","keeps carry alive","rewards hedgers"],
  agri:["resets margins","prices inputs","moves with weather","honors storage","disciplines basis"],
  central:["moves reserves","re-maps collateral","tightens the joints","lets balance sheets speak","prices discretion"]
};

let POOLS = {
  markets:[
    "Basis narrows as funding stops paying for hurry; spreads compress where market functioning heals.",
    "Macro surprises fade and variance migrates from headlines to allocation choices.",
    "Carry income is real only where the collateral stack is honest; elsewhere it is theatre with a tab.",
    "Term premia move like forbearance does: slowly, then convincingly.",
    "The vol surface votes with cash; you either respect it or donate.",
    "Liquidity is a rented story; collateral is the owned one."
  ],
  policy:[
    "Supervision works like gravity—slow, constant, indifferent to speeches.",
    "Collateral frameworks, not tweets, redraw cross-border risk at the margin.",
    "Policy trades one constraint for another; follow the plumbing, not the podium.",
    "Treaties travel slowly; incentives cross borders daily."
  ],
  behaviour:[
    "Bias is a cost; markets extract it one impatience at a time.",
    "Momentum is a servant, not a thesis—do not let it spend your capital.",
    "When correlations wobble, calm hands let time do the persuading.",
    "Discipline is a savings account; drama is an overdraft."
  ],
  energy:[
    "Inventories and freight set the conversation; opinions show up late and leave early.",
    "Tightness is arithmetic, not attitude; the curve knows.",
    "Crack spreads translate scarcity into schedules."
  ],
  fx:[
    "Growth divergence—not virtue—explains the dollar’s posture.",
    "Curve steepening is not a sermon—it is a schedule.",
    "Real yields talk; crosses listen."
  ],
  housing:[
    "Affordability stabilizes where wages outrun rents; the floor is behavioural as much as financial.",
    "Permits are policy in practice; supply elasticity arrives with signatures, not slogans."
  ],
  commodities:[
    "Logistics normalize; curves remember gravity.",
    "Softs trade weather maps, not myths; price the maps.",
    "Freight and storage arbitrate the argument; basis settles it."
  ],
  metals:[
    "Copper tests courage; gold prices forbearance; both remember funding first.",
    "Refined versus mined tells you where the constraint lives."
  ],
  coffee:[
    "Arabica remains tight as differentials repair; logistics finally cooperate.",
    "Weather trades money; weather maps trade edge."
  ],
  agri:[
    "Wheat resets margins on freight; corn watches inputs and learns.",
    "Storage is policy for agriculture; it always was."
  ],
  central:[
    "Balance sheets whisper what communiqués will not admit.",
    "Liquidity is policy in practice; the press release is theatre.",
    "Swap lines are diplomacy without speeches.",
    "Minutes narrate; balance-sheet tables testify."
  ]
};

/* ================= Adviser rewrite / uniqueness ================= */
function rewriteOnce(s,i){
  let out=s
   .replace(/\bpolicy\b/gi,'policy mix')
   .replace(/\bcarry\b/gi,'income carry')
   .replace(/\bliquidity\b/gi,'market functioning')
   .replace(/\bvolatility\b/gi,'variance')
   .replace(/\bpositioning\b/gi, i%2 ? 'stance' : 'market stance')
   .replace(/\btrade\b/gi,'allocation')
   .replace(/\bhedge\s*funds?\b/gi,'leveraged actors')
   .replace(/\bbanks?\b/gi,'intermediaries')
   .replace(/\bbet\b/gi,'exposure')
   .replace(/\bshort\b/gi,'downside exposure')
   .replace(/\blong\b/gi,'upside exposure')
   .replace(/\bpivot\b/gi,'policy reset')
   .replace(/\bpanic\b/gi,'hurry')
   .replace(/\bcollapse\b/gi,'repricing')
   .replace(/\boptimism\b/gi,'constructive bias');
  if(out.includes(';') && i%2===1){const parts=out.split(';'); if(parts.length===2) out=parts[1].trim()+'. '+parts[0].trim()+'.'}
  return out;
}
let __daySentences=new Set();
function splitSents(t){const m=t.match(/[^.!?]+(?:[.!?]+|$)/g)||[];return m.map(s=>s.trim()).filter(Boolean)}
function uniquePara(text){
  const s=splitSents(text).map((x,i)=>{let v=x,tries=0;while(__daySentences.has(v)&&tries<6){v=rewriteOnce(v,tries++)}__daySentences.add(v);return v});
  return (s.length?s:['Signals over spectacle.']).join(' ')
}
const AVOID=[/hedge\s*fund/gi,/\bprop desk\b/gi,/\bwall street\b/gi,/\bbet\b/gi];
function sanitizeCopy(t){let s=t;AVOID.forEach(rx=>{s=s.replace(rx,'leveraged actors')});return s}

/* ================= Dek + Memo ================= */
function craftDek(title,sectionKey){
  const verbs=(DEK_VERBS[sectionKey]||DEK_VERBS.markets);
  const pivot=title.split(':')[0].split('—')[0].split('-')[0].trim();
  return `${pivot} ${pick(verbs)} while we keep incentives above applause.`;
}
const MEMO_BRIDGES=["Put simply:","Operationally:","In practice:","For allocation committees:","For family-office mandates:"];
const ACTION_VERBS=["consider raising","consider trimming","accumulate gradually","phase in","phase out","prefer quality over speed","defer","stagger entries","size to tolerance","maintain optionality"];
const RISK_RAILS=["Liquidity air-pockets","Policy-path variance","Execution slippage","Exogenous shocks","Headline-driven gap risk","Basis instability","FX translation noise","Calendar clustering"];
const HORIZONS=["2–4 weeks (tactical)","1–3 quarters (cyclical)","12–18 months (structural)"];

function buildAdviserMemo(headline,sectionKey){
  const pool=(POOLS[sectionKey]||POOLS[Object.keys(POOLS)[0]]).slice();
  const insightN=5+rint(0,2);
  const insight=[pick(OPENERS)(headline)];
  while(insight.length<insightN && pool.length){insight.push(rewriteOnce(pool.shift(),insight.length))}
  const implication=[
    "Implication: incentives—not applause—govern the next mile.",
    pick(MEMO_BRIDGES)+" prefer signal that cash-flows can service.",
    "Where variance stays elevated, patience is paid in optionality, not speed."
  ].slice(0,2+rint(0,1));
  const act=[
    "Actions: "+pick(MEMO_BRIDGES)+" "+pick(ACTION_VERBS)+" exposure where balance-sheet honesty is observable.",
    "Favor sequences that let you reassess without penalty; avoid heroics.",
    "If sizing feels like theater, it is; scale to sleep and audit the income."
  ];
  if(Math.random()<0.6) act.push("Use calendars, not headlines, to time adjustments; rebalance on dates, not emotions.");
  const risk=[
    "Risk radar: "+pick(RISK_RAILS)+" could widen dispersion; pre-decide tripwires.",
    "Accept variance you are paid for; refuse variance you merely narrate.",
    "Stress-test exposure to a bad sequence, not a bad headline."
  ].slice(0,2+rint(0,1));
  const horizon=[
    "Horizon: plan across "+pick(HORIZONS)+"; sequence allows correction without regret.",
    "Bottom line: price first, story second; size to sleep, compound the habits that pay."
  ];
  return [...insight,...implication,...act,...risk,...horizon].map(uniquePara);
}
function craftParagraphs(headline,sectionKey){return buildAdviserMemo(headline,sectionKey)}

/* ================= Sections / Seeds ================= */
const SECTIONS=[
  {key:'markets',name:'Markets & Macro'},
  {key:'policy',name:'International Law & Policy'},
  {key:'behaviour',name:'Behaviour & Psychology'},
  {key:'energy',name:'Energy & Industry'},
  {key:'fx',name:'FX & Rates'},
  {key:'housing',name:'Housing & Credit'},
  {key:'commodities',name:'Commodities'},
  {key:'metals',name:'Metals'},
  {key:'coffee',name:'Coffee & Sugar'},
  {key:'agri',name:'Agriculture'},
  {key:'central',name:'Central Banking & Institutions'}
];
let SEEDS={
  markets:["Liquidity Learns To Breathe As Spreads Heal","Macro Turns Gradually, Then Convincingly","Positioning Confesses While Real Yields Blink"],
  policy:["Supervision Nudges; The Policy Mix Reprices Time","Collateral Rules Quietly Redraw The Map","When Jurisdiction Moves, Capital Listens"],
  behaviour:["Signal Over Spectacle: Bias Is Expensive","When The Reflex Is Indignation, Structure Wins","Patience Isn’t Passive; It’s Paid"],
  energy:["ICE Brent 1st: Tightness Trains The Tape","TTF Front-Month: Storage Leads, Noise Trails","Refining Rediscovers Cycles"],
  fx:["Dollar Smile Widens; Carry Learns Manners","Curve Steepening Rewrites The Crosses","Real Yields Reassert Themselves"],
  housing:["Housing Finds A Floor; Credit Stops Tightening","Affordability Heals Where Incomes Outrun Rents","Supply Elasticity Finally Arrives"],
  commodities:["Curves Relearn Gravity As Logistics Normalize","Softs Rally On Weather, Not Drama","Inventories Reprice The Next Mile"],
  metals:["Copper Tests Bearish Patience; Gold Holds Bid","Aluminium Flags Scarcity; Nickel Normalizes","Metals Reconnect With Funding"],
  coffee:["Arabica Tightens As Differentials Repair","Sugar Premiums Fade As Supply Normalizes","Softs Ride Weather Maps, Not Headlines"],
  agri:["Wheat Resets Margins; Freight Matters","Corn Tracks Inputs; Yields Surprise","Soybeans Catch A Bid As Freight Eases"],
  central:["ECB Nudges Collateral; Dollar Liquidity Blinks","The Fed’s Balance Sheet Talks Louder Than The FOMC","BIS Silence Prices More Than A Speech"]
};

/* ================= Charts per topic ================= */
function makeTopicCharts(sectionKey){
  const months=60,future=6,labels=monthAxis(months,future), mk=(name,data)=>{
    const main=[...data], f=makeForecast(main,future), area=withFutureSpace([...main],future), price=withFutureSpace([...main],future), proj=Array(main.length).fill(null).concat(f);
    return { title:name, labels, future, series:[
      {name:name, type:'area', data:area},
      {name:name+' (price)', type:'line-solid', data:price, _isPrice:true},
      {name:name+' (proj.)', type:'line-dotted', data:proj}
    ]};
  };
  const base=rwalk(60,100,.22), infl=rwalk(60,2.6,.03), rate=rwalk(60,1.25,.02);
  const brent=rwalk(60,78,1.4), wti=rwalk(60,75,1.5), ttf=rwalk(60,40,.35), hub=rwalk(60,3.0,.18);
  const copper=rwalk(60,8800,32), gold=rwalk(60,2000,10), silver=rwalk(60,25,.25), aluminium=rwalk(60,2300,18), nickel=rwalk(60,18000,120);
  const arabica=rwalk(60,180,2.2), sugar=rwalk(60,20,.25), oj=rwalk(60,350,4.0), water=rwalk(60,60,.6), bdi=rwalk(60,1500,22);
  const dxy=rwalk(60,103,.6), eurusd=rwalk(60,1.08,.004), usdjpy=rwalk(60,155,.25), us10y=rwalk(60,4.1,.03), bund10y=rwalk(60,2.4,.02);
  switch(sectionKey){
    case 'markets': return [ mk('Composite Activity Index (2019=100)', base), mk('HICP YoY (%)', infl) ];
    case 'policy': return [ mk('Policy Rate Path Proxy (%)', rate), mk('Financial Conditions (z-score)', base.map(v=>+((v-100)/5).toFixed(2))) ];
    case 'behaviour': return [ mk('Risk Appetite Proxy (Index)', base.map((v,i)=>+(v*(1+0.02*Math.sin(i/8))).toFixed(2))), mk('Sentiment Oscillator (Index)', base.map((v,i)=>+(100+10*Math.sin(i/4)).toFixed(2))) ];
    case 'energy': return [ mk('ICE Brent 1st ($/bbl)', brent), mk('WTI 1st ($/bbl)', wti), mk('TTF Gas 1st (€/MWh)', ttf) ];
    case 'fx': return [ mk('DXY Index', dxy), mk('EURUSD', eurusd), mk('USDJPY', usdjpy), mk('US 10Y Yield (%)', us10y), mk('DE 10Y Bund (%)', bund10y) ];
    case 'housing': return [ mk('Housing Activity (2019=100)', base), mk('Mortgage Rate Proxy (%)', base.map((v,i)=>+(2.5+0.02*i+0.2*Math.sin(i/7)).toFixed(2))) ];
    case 'commodities': return [ mk('Henry Hub 1st ($/MMBtu)', hub), mk('Baltic Dry Index', bdi), mk('Water Price Index (proxy)', water) ];
    case 'metals': return [ mk('LME Copper 3M (USD/t)', copper), mk('Gold Spot (USD/oz)', gold), mk('Silver Spot (USD/oz)', silver), mk('Aluminium 3M (USD/t)', aluminium), mk('Nickel 3M (USD/t)', nickel) ];
    case 'coffee': return [ mk('KC Arabica 1st (¢/lb)', arabica), mk('Sugar #11 1st (¢/lb)', sugar), mk('Frozen Concentrated Orange Juice (¢/lb)', oj) ];
    case 'agri': return [ mk('CBOT Wheat 1st (c/bu)', rwalk(60,600,6)), mk('CBOT Corn 1st (c/bu)', rwalk(60,500,5)), mk('CBOT Soybeans 1st (c/bu)', rwalk(60,1200,10)) ];
    case 'central': return [ mk('Fed Balance Sheet (proxy, $tn)', rwalk(60,8.2,0.06)), mk('ECB APP+PEPP (proxy, €tn)', rwalk(60,4.9,0.05)), mk('RRP Facility Usage (proxy, $bn)', rwalk(60,1200,15)), mk('Bank Reserves (proxy, $bn)', rwalk(60,3200,12)) ];
    default: return [ mk('Composite Activity Index (2019=100)', base), mk('HICP YoY (%)', infl) ];
  }
}

/* ================= Post synthesis & rendering ================= */
function synthesizePost(seedTitle,dateObj,sectionKey){
  const tags=["Markets","Policy","Behaviour","Credit","Energy","FX","Housing","Supply Chain","Liquidity","Jurisdiction","Commodities","Metals","Softs","Agri","Central"];
  const charts=makeTopicCharts(sectionKey);
  const paragraphs=craftParagraphs(seedTitle,sectionKey);
  return {
    id:"p_"+Math.random().toString(36).slice(2,8),
    title:seedTitle,
    dek:craftDek(seedTitle,sectionKey),
    paragraphs,
    charts,
    published:randomCETDisplayString(dateObj),
    tag1:pick(tags), tag2:pick(tags),
    sectionKey
  };
}

function renderSection(container,sectionKey,dateObj){
  const seeds=SEEDS[sectionKey]||["Positioning is wrong again."];
  const count=rint(1,2); // 1–2 per section/day
  for(let i=0;i<count;i++){
    const seed=pick(seeds), post=synthesizePost(seed,dateObj,sectionKey);
    const art=document.createElement('article'); art.className='panel grid'; art.id=post.id; art.dataset.section=sectionKey; art.dataset.charts=JSON.stringify(post.charts); art.dataset.title=post.title; art.dataset.dek=post.dek; art.dataset.published=post.published;
    art.innerHTML='<div class="kicker">'+(post.sectionKey.toUpperCase())+'</div>'
      +'<h3 class="headline">'+esc(post.title)+'</h3>'
      +'<p class="deck">'+esc(post.dek)+'</p>'
      +'<div class="meta"><span class="badge">'+esc(post.tag1)+'</span><span class="badge">'+esc(post.tag2)+'</span><span>•</span><time>'+post.published+'</time><button class="badge" style="margin-left:auto" data-print-id="'+post.id+'">Print Report</button></div>'
      +'<div class="meta" style="opacity:.8"><span class="badge">Adviser View</span><span>•</span><span>Independent, client-first</span></div>';
    const prose=document.createElement('div'); prose.className='prose'; prose.innerHTML=post.paragraphs.map(x=>'<p>'+esc(sanitizeCopy(x))+'</p>').join('');
    art.appendChild(prose);
    const grid=document.createElement('div'); grid.className='charts-grid';
    post.charts.forEach(spec=>{
      const wrap=document.createElement('div'); wrap.className='chartwrap';
      const title=document.createElement('div'); title.style="font-size:12px;opacity:.8;margin:6px 0"; title.textContent=spec.title;
      const canvas=document.createElement('canvas'); wrap.appendChild(title); wrap.appendChild(canvas); grid.appendChild(wrap);
      setTimeout(()=>drawChart(canvas,spec),0);
      const src=document.createElement('div'); src.style="font-size:11px;opacity:.6;margin:4px 0 0 0"; src.textContent="Illustrative proxy series — independent advisory view"; wrap.appendChild(src);
    });
    art.appendChild(grid);
    container.appendChild(art);
  }
}

/* ================= Print (per-article) ================= */
function printArticleById(id){
  try{
    const art=document.getElementById(id); if(!art) throw new Error('Article not found: '+id);
    const title=art.dataset.title||'', dek=art.dataset.dek||'', published=art.dataset.published||'', section=(art.dataset.section||'').toUpperCase();
    const paras=Array.from(art.querySelectorAll('.prose p')).map(p=>p.textContent);
    const win=window.open('','_blank'); if(!win) throw new Error('Popup blocked. Allow popups to print.');
    const doc=win.document;
    doc.write(`<!doctype html><html><head><meta charset="utf-8"><title>${title} — Report</title>
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <style>
        body{font:14px system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif;color:#000;margin:24px}
        h1{margin:0 0 6px 0;font-size:22px} h2{margin:0 0 12px 0;font-size:13px;color:#444;letter-spacing:.12em}
        .dek{margin:6px 0 10px 0;font-size:14px;color:#111}
        .meta{font-size:12px;color:#555;margin-bottom:10px}
        .prose{line-height:1.65;font-size:14.5px} .panel{border:1px solid #ccc;border-radius:10px;padding:16px}
        .grid{display:grid;gap:12px} canvas{display:block;width:100%;height:420px;background:#f7f7f9;border-radius:8px;padding:6px}
        @media print{body{margin:12px}}
      </style>
      <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"><\/script>
    </head><body>
    <div class="panel">
      <div style="font-size:12px;opacity:.75;margin:2px 0 8px 0">Independent Strategy Memorandum — For informational purposes only</div>
      <h2>${section}</h2><h1>${title}</h1><div class="dek">${dek}</div><div class="meta">${published}</div>
      <div class="prose">${paras.map(p=>`<p>${p}</p>`).join('')}</div><div class="grid" id="chartHost"></div>
    </div>
    <script>
      function gradientBlue(ctx){const g=ctx.createLinearGradient(0,0,0,260);g.addColorStop(0,'rgba(31,119,180,.35)');g.addColorStop(1,'rgba(31,119,180,.05)');return g}
      function draw(spec){
        const wrap=document.createElement('div'), t=document.createElement('div'); t.textContent=spec.title; t.style.cssText='font-size:12px;opacity:.8;margin:6px 0';
        const c=document.createElement('canvas'); c.height=420; wrap.appendChild(t); wrap.appendChild(c); document.getElementById('chartHost').appendChild(wrap);
        const ctx=c.getContext('2d'); const datasets=[];
        datasets.push({label:spec.title,data:spec.series[0].data,type:'line',borderWidth:2.2,tension:.25,pointRadius:0,spanGaps:false,borderColor:'rgba(31,119,180,.95)',backgroundColor:gradientBlue(ctx),fill:true});
        datasets.push({label:spec.title+' (price)',data:spec.series[1].data,type:'line',borderWidth:2,tension:.25,pointRadius:0,spanGaps:false,borderColor:'#111',backgroundColor:'rgba(0,0,0,0)',fill:false,_isPrice:true});
        datasets.push({label:spec.title+' (proj.)',data:spec.series[2].data,type:'line',borderWidth:1.6,tension:.25,pointRadius:0,spanGaps:false,borderColor:'#333',backgroundColor:'rgba(0,0,0,0)',fill:false,borderDash:[4,4]});
        new Chart(ctx,{type:'line',data:{labels:spec.labels,datasets},options:{responsive:false,maintainAspectRatio:false,layout:{padding:{right:32}},scales:{x:{grid:{color:'#ddd'}},y:{grid:{color:'#eee'}}}}});
      }
      (JSON.parse(window.opener.document.getElementById('${id}').dataset.charts||'[]')).forEach(draw);
      setTimeout(()=>{window.print()},350);
    <\/script></body></html>`);
    doc.close();
  }catch(e){console.error(e);alert('Print error: '+(e.message||e))}
}
document.addEventListener('click',ev=>{const b=ev.target.closest('[data-print-id]');if(b){ev.preventDefault();printArticleById(b.getAttribute('data-print-id'))}});

/* ================= Archive ================= */
function buildArchive(){
  const host=document.getElementById('archive-list'); if(!host) return; host.innerHTML='';
  const now=new Date(); const startYear=2020;
  document.getElementById('arcYears').textContent='(2020–'+now.getFullYear()+')';
  for(let y=now.getFullYear(); y>=startYear; y--){
    for(let m=12;m>=1;m-=3){
      const date=new Date(y,m-1,15);
      const b=document.createElement('button'); b.className='badge'; b.style.cursor='pointer';
      b.textContent=date.toLocaleDateString(undefined,{month:'short',year:'numeric'});
      b.addEventListener('click',()=>{let d=new Date(y,m-1,rint(2,26));const wd=d.getDay();if(wd===0)d.setDate(d.getDate()+1);if(wd===6)d.setDate(d.getDate()+2); renderEdition(d); scrollTo({top:0,behavior:'smooth'})});
      host.appendChild(b);
    }
  }
}

/* ================= Chips & Edition ================= */
function buildChips(){
  const host=document.getElementById('topic-chips'); if(!host) return; host.innerHTML='';
  SECTIONS.forEach(s=>{const span=document.createElement('span'); span.className='badge'; span.textContent=s.name; host.appendChild(span)});
}
function renderEdition(dateObj){
  __daySentences.clear();
  const host=document.getElementById('sections'); if(!host) return; host.innerHTML='';
  const d=ensureWeekday(dateObj);
  document.getElementById('datestamp').textContent='— '+ new Date().toLocaleDateString(undefined,{year:'numeric',month:'long',day:'numeric'});
  SECTIONS.forEach(sec=>{
    const block=document.createElement('div'); block.style.marginTop='12px';
    block.innerHTML='<h3 class="section-title">'+esc(sec.name)+'</h3>';
    const holder=document.createElement('div'); holder.className='grid';
    block.appendChild(holder); host.appendChild(block);
    const row=document.createElement('div'); row.className='grid posts'; holder.appendChild(row);
    renderSection(row,sec.key,d);
  });
}

/* ================= Seed-word miner (public sources) ================= */
const FEEDS=[
  "https://www.ecb.europa.eu/press/calendar/html/index.en.html",
  "https://www.ecb.europa.eu/press/pr/html/index.en.html",
  "https://www.bis.org/list/press_releases.rss",
  "https://www.imf.org/external/whatson/api/Calendar",
  "https://blogs.worldbank.org/en/feed",
  "https://www.zerohedge.com/rss.xml"  // titles only; for keywords (no text copying)
];
function extractKeywords(text){
  text=(text||'').replace(/[\u2018\u2019]/g,"'").replace(/[“”]/g,'"');
  const words=text.split(/[^A-Za-z0-9%&:+/.-]+/).filter(Boolean);
  const stop=new Set(["the","a","of","and","to","for","with","in","on","by","at","from","as","into","about","over","under","after","before","is","are","will","be","an"]);
  let keys=[]; for(let w of words){const lw=w.toLowerCase(); if(stop.has(lw)||lw.length<3) continue; if(/^\d/.test(w)) continue; if(/[A-Z]/.test(w)||/^[A-Z0-9]{2,6}$/.test(w)) keys.push(w.replace(/[:;,]+$/,''))}
  return Array.from(new Set(keys)).slice(0,12);
}
async function grab(url){try{const r=await fetch(url,{mode:'cors',cache:'no-store'});if(!r.ok) throw 0;return await r.text()}catch(e){return ""}}
function parseTitles(payload){
  if(!payload) return [];
  if(/^\s*\{/.test(payload)) { // JSON endpoints (IMF)
    try { const j=JSON.parse(payload); const titles=[]; const walk=v=>{ if(!v) return; if(typeof v==='string' && v.length<180) titles.push(v); else if(Array.isArray(v)) v.forEach(walk); else if(typeof v==='object') Object.values(v).forEach(walk) }; walk(j); return titles; } catch(_){ return []; }
  }
  if(/<rss/i.test(payload)) return [...payload.matchAll(/<title>([\s\S]*?)<\/title>/gi)].map(x=>x[1]).slice(1);
  const titles=[]; const tt=payload.match(/<title>([\s\S]*?)<\/title>/i); if(tt) titles.push(tt[1]);
  const hs=[...payload.matchAll(/<h[1-3][^>]*>([\s\S]*?)<\/h[1-3]>/gi)].map(m=>m[1].replace(/<[^>]+>/g,'').trim());
  titles.push(...hs);
  const as=[...payload.matchAll(/<a[^>]*>([\s\S]*?)<\/a>/gi)].map(m=>m[1].replace(/<[^>]+>/g,'').trim());
  titles.push(...as.slice(0,30));
  return titles.filter(Boolean);
}
function synthesizeUniqueTitle(sectionKey,keys){
  const sel=keys.slice(0,3);
  const flavors=[
    `${sel[0]||'Policy'} Signals While ${sel[1]||'Funding'} Learns`,
    `${sel[0]||'Balance Sheet'} Meets ${sel[1]||'Collateral'}; ${sel[2]||'Liquidity'} Reprices Time`,
    `${sel[0]||'Jurisdiction'} Redraws ${sel[1]||'Flows'}; ${sel[2]||'Markets'} Adjust Sequencing`,
    `${sel[0]||'Curve'} Steepens As ${sel[1]||'Reserves'} Migrate`
  ];
  return flavors[Math.floor(Math.random()*flavors.length)];
}
function synthesizeUniqueDek(sectionKey,keys){
  const v=(DEK_VERBS[sectionKey]||DEK_VERBS.markets);
  const pivot=(keys[0]||'The cycle');
  return `${pivot} ${pick(v)} while we keep incentives above applause.`;
}
function dayKey(){const d=new Date();return d.toISOString().slice(0,10)}
function sha1(t){let h=0;for(let i=0;i<t.length;i++){h=((h<<5)-h)+t.charCodeAt(i);h|=0}return String(h>>>0)}
function oncePerDay(key,maker){const k=dayKey()+':'+key;const cache=JSON.parse(localStorage.getItem('uniqSeeds')||'{}');if(cache[k])return cache[k];const v=maker();cache[k]=v;localStorage.setItem('uniqSeeds',JSON.stringify(cache));return v}
async function refreshSeedsFromPublic(){
  const blobs=await Promise.all(FEEDS.map(grab));
  const titles=blobs.flatMap(parseTitles).filter(Boolean);
  const packs=titles.map(extractKeywords).filter(a=>a.length>=2);
  const bag={markets:[],policy:[],behaviour:[],energy:[],fx:[],housing:[],commodities:[],metals:[],coffee:[],agri:[],central:[]};
  packs.forEach(pk=>{
    const tk=pk.join(' ');
    const route=/ECB|Fed|FOMC|RRP|PEPP|APP|BIS|Reserves|Collateral|Target2/i.test(tk)?'central'
      :/Brent|WTI|gas|TTF|OPEC|refine|inventory/i.test(tk)?'energy'
      :/USD|EUR|JPY|DXY|yield|curve|bund|gilts|swap/i.test(tk)?'fx'
      :/wheat|corn|soy|harvest|rain|agri|fertilizer/i.test(tk)?'agri'
      :/copper|gold|silver|aluminium|nickel/i.test(tk)?'metals'
      :/sugar|coffee|arabica|robusta|cocoa|orange/i.test(tk)?'coffee'
      :/home|permit|mortgage|rent|housing|credit/i.test(tk)?'housing'
      :/freight|dry|bdi|water|logistics|inventory/i.test(tk)?'commodities'
      :/policy|treaty|sanction|law|jurisdiction|supervision/i.test(tk)?'policy'
      :/bias|behav|sentiment|psych/i.test(tk)?'behaviour'
      :'markets';
    bag[route].push(pk);
  });
  for(const sec of Object.keys(bag)){
    const arr=bag[sec];
    if(!arr || !arr.length) continue; // keep defaults if nothing harvested
    const picks=arr.sort(()=>Math.random()-0.5).slice(0,3);
    SEEDS[sec]=picks.map(keys=> oncePerDay(sec+'-'+sha1(keys.join('|')), ()=>synthesizeUniqueTitle(sec,keys)));
    if(!window.__dekKeyBag) window.__dekKeyBag={};
    window.__dekKeyBag[sec]=picks.map(keys=>keys);
  }
}
const _origCraftDek=craftDek;
craftDek=function(title,sectionKey){
  if(window.__dekKeyBag && window.__dekKeyBag[sectionKey] && window.__dekKeyBag[sectionKey].length){
    const keys=window.__dekKeyBag[sectionKey].shift(); if(keys){return synthesizeUniqueDek(sectionKey,keys)}
  }
  return _origCraftDek(title,sectionKey);
};

/* ================= Boot (non-blocking) ================= */
async function boot(){
  try{
    const attempt=(typeof refreshSeedsFromPublic==='function')?refreshSeedsFromPublic().catch(()=>{}):Promise.resolve();
    await Promise.race([attempt,new Promise(res=>setTimeout(res,800))]);
    renderEdition(new Date());
    buildChips();
    buildArchive();
  }catch(_){
    try{renderEdition(new Date());buildChips();buildArchive();}catch(e2){const er=document.getElementById('err');if(er){er.style.display='block';er.textContent='Init error: '+(e2.message||e2)}}
  }
}
if(document.readyState==='loading'){document.addEventListener('DOMContentLoaded',boot)} else {boot()}

/* ================= Anti-copy hardening (casual) ================= */
document.addEventListener('contextmenu',e=>e.preventDefault());
document.addEventListener('keydown',e=>{
  const k=e.key.toLowerCase();
  if(e.ctrlKey && (k==='u'||k==='s'||k==='c'||k==='p')) e.preventDefault();
  if(e.key==='F12'||(e.ctrlKey&&e.shiftKey&&(k==='i'||k==='j'))) e.preventDefault();
});
document.addEventListener('selectstart',e=>e.preventDefault());
</script>

<!-- Fail-safe bootstrap shim: force render even if boot never runs -->
<script>
(function(){
  function force(){
    try{
      if (typeof renderEdition==='function') renderEdition(new Date());
      if (typeof buildChips==='function') buildChips();
      if (typeof buildArchive==='function') buildArchive();
      var hasPosts=document.querySelector('#sections article');
      if(!hasPosts){
        var er=document.getElementById('err');
        if(er){er.style.display='block';er.textContent='Rendered fallback: no posts detected — check earlier scripts or feed CORS.';}
      }
    }catch(e){
      var er=document.getElementById('err');
      if(er){er.style.display='block';er.textContent='Fallback error: '+(e.message||e);}
    }
  }
  try{
    if(document.readyState==='loading'){
      document.addEventListener('DOMContentLoaded',function(){try{(typeof boot==='function'?boot():force())}catch(_){force()}});
    }else{(typeof boot==='function'?boot():force())}
  }catch(_){setTimeout(force,1200)}
})();
</script>
</body>
</html>

